<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>v2 = slow-mo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
        }
        .toolbar {
            width: 60px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
            margin-right: 20px;
        }
        .tool-button {
            width: 40px;
            height: 40px;
            margin: 5px;
            cursor: pointer;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .tool-button.active {
            background: #2196F3;
            color: white;
        }
        .main-content {
            flex-grow: 1;
            text-align: center;
        }
        .canvas-container {
            position: relative;
            display: inline-block;
        }
        canvas {
            max-width: 90%;
            max-height: 80vh;
        }
        #drawingCanvas {
            position: absolute;
            left: 0;
            top: 0;
        }
        .controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        input[type="range"] {
            width: 300px;
        }
        button {
            padding: 8px 20px;
            margin: 0 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background: #2196F3;
            color: white;
        }
        button:hover {
            background: #1976D2;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
<div class="toolbar">
    <button class="tool-button active" id="lineButton">‚úèÔ∏è</button>
    <button class="tool-button" id="selectButton">üëÜ</button>
</div>
<div class="main-content">
    <h1>v2 - slow-mo</h1>
    <input type="file" id="fileInput" accept="video/*">
    <div class="canvas-container">
        <canvas id="mirroredVideo"></canvas>
        <canvas id="drawingCanvas"></canvas>
    </div>
    <div class="playback-controls">
        <button id="playButton" disabled>Play</button>
        <button id="pauseButton" disabled>Pause</button>
    </div>
    <div class="controls">
        <div class="control-group">
            <span id="currentTime">0:00</span>
            <input type="range" id="progressSlider" min="0" max="100" value="0">
            <span id="duration">0:00</span>
        </div>
        <div class="control-group">
            <label for="speedControl">Speed: </label>
            <input type="range" id="speedControl" min="0.1" max="1" step="0.1" value="1">
            <span id="speedValue">1x</span>
        </div>
    </div>
</div>
<script>
    const fileInput = document.getElementById('fileInput');
    const mirroredCanvas = document.getElementById('mirroredVideo');
    const drawingCanvas = document.getElementById('drawingCanvas');
    const ctx = mirroredCanvas.getContext('2d');
    const drawCtx = drawingCanvas.getContext('2d');
    const speedControl = document.getElementById('speedControl');
    const speedValue = document.getElementById('speedValue');
    const progressSlider = document.getElementById('progressSlider');
    const currentTimeDisplay = document.getElementById('currentTime');
    const durationDisplay = document.getElementById('duration');
    const playButton = document.getElementById('playButton');
    const pauseButton = document.getElementById('pauseButton');

    const video = document.createElement('video');
    video.controls = false; // Disable default browser controls
    video.style.display = 'none'; // Hide the video element
    video.playsInline = true; // Prevent fullscreen behavior on iOS
    document.body.appendChild(video);

    let animationFrame;

    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        const videoURL = URL.createObjectURL(file);
        video.src = videoURL;

        video.onloadedmetadata = () => {
            mirroredCanvas.width = video.videoWidth;
            mirroredCanvas.height = video.videoHeight;
            drawingCanvas.width = video.videoWidth;
            drawingCanvas.height = video.videoHeight;

            progressSlider.max = Math.floor(video.duration);
            durationDisplay.textContent = formatTime(video.duration);

            playButton.disabled = false;
            pauseButton.disabled = true;

            // Draw the first frame
            updateMirroredVideo();
        };
    });

    function updateMirroredVideo() {
        ctx.save();
        ctx.scale(-1, 1); // Flip horizontally for mirrored effect
        ctx.drawImage(video, -mirroredCanvas.width, 0, mirroredCanvas.width, mirroredCanvas.height);
        ctx.restore();

        if (!video.paused && !video.ended) {
            animationFrame = requestAnimationFrame(updateMirroredVideo);
        }
    }

    playButton.addEventListener('click', () => {
        video.play();
        playButton.disabled = true;
        pauseButton.disabled = false;

        // Start the animation loop
        updateMirroredVideo();
    });

    pauseButton.addEventListener('click', () => {
        video.pause();
        playButton.disabled = false;
        pauseButton.disabled = true;

        // Stop the animation loop
        cancelAnimationFrame(animationFrame);
    });

    speedControl.addEventListener('input', (e) => {
        const speed = e.target.value;
        video.playbackRate = speed; // Adjust video playback speed
        speedValue.textContent = `${speed}x`;
    });

    video.addEventListener('timeupdate', () => {
        progressSlider.value = video.currentTime;
        currentTimeDisplay.textContent = formatTime(video.currentTime);
    });

    progressSlider.addEventListener('input', (e) => {
        const time = e.target.value;
        video.currentTime = time; // Seek the video
        currentTimeDisplay.textContent = formatTime(time);
        updateMirroredVideo(); // Ensure the canvas updates immediately
    });

    // Format time for display
    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // Drawing Logic
    let isDrawing = false;
    let lastX, lastY;

    drawingCanvas.addEventListener('mousedown', (e) => {
        const coords = getCanvasCoordinates(e);
        isDrawing = true;
        lastX = coords.x;
        lastY = coords.y;
    });

    drawingCanvas.addEventListener('mousemove', (e) => {
        if (!isDrawing) return;

        const coords = getCanvasCoordinates(e);
        drawCtx.beginPath();
        drawCtx.moveTo(lastX, lastY);
        drawCtx.lineTo(coords.x, coords.y);
        drawCtx.strokeStyle = '#FF0000';
        drawCtx.lineWidth = 2;
        drawCtx.stroke();

        lastX = coords.x;
        lastY = coords.y;
    });

    drawingCanvas.addEventListener('mouseup', () => {
        isDrawing = false;
    });

    drawingCanvas.addEventListener('mouseleave', () => {
        isDrawing = false;
    });

    function getCanvasCoordinates(e) {
        const rect = drawingCanvas.getBoundingClientRect();
        const scaleX = drawingCanvas.width / rect.width;
        const scaleY = drawingCanvas.height / rect.height;
        return {
            x: (e.clientX - rect.left) * scaleX,
            y: (e.clientY - rect.top) * scaleY
        };
    }
</script>


</body>
</html>
